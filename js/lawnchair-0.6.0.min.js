var Lawnchair=function(){if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(arguments.length<=2&&arguments.length>0)var a=typeof arguments[0]==="function"?arguments[0]:arguments[1],c=typeof arguments[0]==="function"?{}:arguments[0];else throw"Incorrect # of ctor args!";if(typeof a!=="function")throw"No callback was provided";this.record=c.record||"record";this.name=c.name||"records";var d;if(c.adapter){d=Lawnchair.adapters[Lawnchair.adapters.indexOf(c.adapter)];d=d.valid()?
d:undefined}else for(var b=0,e=Lawnchair.adapters.length;b<e;b++)if(d=Lawnchair.adapters[b].valid()?Lawnchair.adapters[b]:undefined)break;if(!d)throw"No valid adapter.";for(var f in d)this[f]=d[f];b=0;for(e=Lawnchair.plugins.length;b<e;b++)Lawnchair.plugins[b].call(this);this.init(c,a)};Lawnchair.adapters=[];
Lawnchair.adapter=function(a,c){c.adapter=a;var d="adapter valid init keys save batch get exists all remove nuke".split(" "),b;for(b in c)if(d.indexOf(b)===-1)throw"Invalid adapter! Nonstandard method: "+b;Lawnchair.adapters.push(c)};Lawnchair.plugins=[];Lawnchair.plugin=function(a){for(var c in a)c==="init"?Lawnchair.plugins.push(a[c]):this.prototype[c]=a[c]};
Lawnchair.prototype={isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},lambda:function(a){return this.fn(this.record,a)},fn:function(a,c){return typeof c=="string"?new Function(a,c):c},uuid:function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},each:function(a){var c=this.lambda(a);if(this.__results){a=0;for(var d=this.__results.length;a<d;a++)c.call(this,this.__results[a],
a)}else this.all(function(b){for(var e=0,f=b.length;e<f;e++)c.call(this,b[e],e)});return this}};
Lawnchair.adapter("dom",{valid:function(){return window.Storage!="undefined"},init:function(a,c){this.storage=window.localStorage;var d=this;this.indexer={key:d.name+"._index_",all:function(){JSON.parse(d.storage.getItem(this.key))==null&&d.storage.setItem(this.key,JSON.stringify([]));return JSON.parse(d.storage.getItem(this.key))},add:function(b){var e=this.all();e.push(b);d.storage.setItem(this.key,JSON.stringify(e))},del:function(b){for(var e=this.all(),f=[],g=0,h=e.length;g<h;g++)e[g]!=b&&f.push(e[g]);
d.storage.setItem(this.key,JSON.stringify(f))},find:function(b){for(var e=this.all(),f=0,g=e.length;f<g;f++)if(b===e[f])return f;return false}};c&&this.fn(this.name,c).call(this,this)},save:function(a,c){var d=a.key||this.uuid();this.indexer.find(d)||this.indexer.add(d);delete a.key;this.storage.setItem(d,JSON.stringify(a));if(c){a.key=d;this.lambda(c).call(this,a)}return this},batch:function(a,c){for(var d=[],b=0,e=a.length;b<e;b++)this.save(a[b],function(f){d.push(f)});c&&this.lambda(c).call(this,
d);return this},keys:function(){callback&&this.lambda(callback).call(this,this.indexer.all())},get:function(a,c){if(this.isArray(a)){for(var d=[],b=0,e=a.length;b<e;b++){var f=JSON.parse(this.storage.getItem(a[b]));if(f){f.key=a[b];d.push(f)}}c&&this.lambda(c).call(this,d)}else{if(f=JSON.parse(this.storage.getItem(a)))f.key=a;c&&this.lambda(c).call(this,f)}return this},all:function(a){for(var c=this.indexer.all(),d=[],b,e=0,f=c.length;e<f;e++){b=JSON.parse(this.storage.getItem(c[e]));b.key=c[e];d.push(b)}a&&
this.fn(this.name,a).call(this,d);return this},remove:function(a,c){var d=typeof a==="string"?a:a.key;this.indexer.del(d);this.storage.removeItem(d);c&&this.lambda(c).call(this);return this},nuke:function(a){this.all(function(c){for(var d=0,b=c.length;d<b;d++)this.remove(c[d]);a&&this.lambda(a).call(this)});return this}});
Lawnchair.adapter("window-name",function(a,c){var d=window.top.name?JSON.parse(window.top.name):{};return{valid:function(){return typeof window.top.name!="undefined"},init:function(b,e){d[this.name]={index:[],store:{}};a=d[this.name].index;c=d[this.name].store;this.fn(this.name,e).call(this,this)},keys:function(b){this.fn("keys",b).call(this,a);return this},save:function(b,e){var f=b.key||this.uuid();b.key&&delete b.key;this.exists(f,function(g){g||a.push(f);c[f]=b;window.top.name=JSON.stringify(d);
if(e){b.key=f;this.lambda(e).call(this,b)}});return this},batch:function(b,e){for(var f=[],g=0,h=b.length;g<h;g++)this.save(b[g],function(i){f.push(i)});e&&this.lambda(e).call(this,f);return this},get:function(b,e){var f;if(this.isArray(b)){f=[];for(var g=0,h=b.length;g<h;g++)f.push(c[b[g]])}else if(f=c[b])f.key=b;e&&this.lambda(e).call(this,f);return this},exists:function(b,e){this.lambda(e).call(this,!!c[b]);return this},all:function(b){for(var e=[],f=0,g=a.length;f<g;f++){var h=c[a[f]];h.key=a[f];
e.push(h)}this.fn(this.name,b).call(this,e);return this},remove:function(b,e){for(var f=this.isArray(b)?b:[b],g=0,h=f.length;g<h;g++){delete c[f[g]];a.splice(a.indexOf(f[g]),1)}window.top.name=JSON.stringify(d);e&&this.lambda(e).call(this);return this},nuke:function(b){storage={};a=[];window.top.name=JSON.stringify(d);b&&this.lambda(b).call(this);return this}}}());
